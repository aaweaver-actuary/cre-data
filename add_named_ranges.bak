'excel VBA script that 
' 1. reads in a files table (one column called "files"), and a ranges table (three columns: "sheet", "range", "name")
' 2. for each file:
' 3.   open the file
' 4.   for each row on the ranges table:
' 5.     set temp_range = range specified by the sheet and range columns
' 6.     set temp_name = name column
' 7.     set temp_range.name = temp_name
' 8.   close the file
' 9. end for

' global variables:
' 1. files_table_data_values: 2D array of the files table data
' 2. ranges_table_data_values: 2D array of the ranges table data

dim files_table_data_values as variant
dim ranges_table_data_values as variant


' 1. input the excel table name, and read in the files table (excel table format) from the active excel file
sub read_files_table(files_table_name)
    set files_table = activeWorkbook.tables(files_table_name)
    set files_table_range = files_table.range
    set files_table_data = files_table_range.offset(1, 0).resize(files_table_range.rows.count - 1, files_table_range.columns.count)
    set files_table_data_values = files_table_data.value
end sub

' 1. input the excel table name, and read in the ranges table (excel table format) from the active excel file
sub read_ranges_table(ranges_table_name)
    set ranges_table = activeWorkbook.tables(ranges_table_name)
    set ranges_table_range = ranges_table.range
    set ranges_table_data = ranges_table_range.offset(1, 0).resize(ranges_table_range.rows.count - 1, ranges_table_range.columns.count)
    set ranges_table_data_values = ranges_table_data.value
end sub

' sub to open the file
sub open_file(file_name)
    workbooks.open(file_name)
end sub

' sub to close the file
sub close_file()
    activeWorkbook.close
end sub

' sub to set the name of a range given the sheet name, range, and name
sub set_range_name(sheet_name, range, name)
    set temp_range = workbooks(activeWorkbook.name).worksheets(sheet_name).range(range)
    temp_range.name = name
end sub

' main sub
sub main()
    ' define variables
    dim i as integer
    dim j as integer
    dim file_name as string
    dim sheet_name as string
    dim range as string
    dim name as string

    ' 1. read in the files table and ranges table and store them in variables
    call read_files_table("files")
    call read_ranges_table("ranges")

    ' 2. for each file:
    for i = 1 to ubound(files_table_data_values, 1)
        ' 3. open the file
        file_name = files_table_data_values(i, 1)
        call open_file(file_name)

        ' 4. for each row on the ranges table:
        for j = 1 to ubound(ranges_table_data_values, 1)
            ' 5. set temp_range = range specified by the sheet and range columns
            sheet_name = ranges_table_data_values(j, 1)
            range = ranges_table_data_values(j, 2)
            name = ranges_table_data_values(j, 3)
            ' 6. set temp_name = name column
            ' 7. set temp_range.name = temp_name
            call set_range_name(sheet_name, range, name)
        next j

        ' 8. close the file
        call close_file()

    next i

    ' 9. end for
end sub